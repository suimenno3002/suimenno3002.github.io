<!doctype html><html lang=en dir=auto><head><meta name=generator content="Hugo 0.127.0"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>suimenno3002's blog</title>
<meta name=keywords content="blog,suimenno3002,rust,ai infra,database"><meta name=description content="存在主义者的自留地"><meta name=author content="suimenno3002"><link rel=canonical href=http://suimenno3002.github.io/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.491c74fb4d187c3956d2e9d2087197eca8be54b870a58e79451ab84c25aa5b65.css integrity="sha256-SRx0+00YfDlW0unSCHGX7Ki+VLhwpY55RRq4TCWqW2U=" rel="preload stylesheet" as=style><link rel=icon href=http://suimenno3002.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://suimenno3002.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://suimenno3002.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://suimenno3002.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://suimenno3002.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=http://suimenno3002.github.io/index.xml><link rel=alternate hreflang=en href=http://suimenno3002.github.io/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-VE0D4BXTS2"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VE0D4BXTS2")}</script><meta property="og:title" content="suimenno3002's blog"><meta property="og:description" content="存在主义者的自留地"><meta property="og:type" content="website"><meta property="og:url" content="http://suimenno3002.github.io/"><meta property="og:image" content="http://suimenno3002.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="og:site_name" content="suimenno3002's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://suimenno3002.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="suimenno3002's blog"><meta name=twitter:description content="存在主义者的自留地"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"suimenno3002's blog","url":"http://suimenno3002.github.io/","description":"存在主义者的自留地","thumbnailUrl":"http://suimenno3002.github.io/%3Clink%20/%20abs%20url%3E","sameAs":["https://github.com/suimenno3002","/index.xml"]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://suimenno3002.github.io/ accesskey=h title="Home (Alt + H)"><img src=http://suimenno3002.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://suimenno3002.github.io/archives title=文章><span>文章</span></a></li><li><a href=http://suimenno3002.github.io/series title=系列><span>系列</span></a></li></ul></nav></header><main class=main><article class="first-entry home-info"><header class=entry-header><h1>Hi there 👋</h1></header><div class=entry-content>Welcome to my blog</div><footer class=entry-footer><div class=social-icons><a href=https://github.com/suimenno3002 target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=/index.xml target=_blank rel="noopener noreferrer me" title=Rss><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div></footer></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent></h2></header><div class=entry-content><p>简介 虽然红包雨复杂度低，但是是 C 端典型（或者说少有）的大流量写业务场景，且需要保障资金安全，根据业务形态和宣传资源，QPS 可达数万至数千万不等，可借由方案的推敲和设计一窥 C 端大流量核心场景系统设计的原则，和互联网后端工程师的核心能力模型 —— 大流量高并发下的系统设计和稳定性与容灾保障。
本文不会涉及具体的方案设计，只能泛泛而谈，希望能给读者一些启发。
需求概述 活动期内，每天定时领取红包。
业务价值 通过玩法将用户导量到入口和出口的场景。
比如免登录态参与玩法引导用户注册。比如玩完红包雨后跳转到春节活动主会场引导用户玩其他玩法。比如在聊天玩红包雨提升群聊活跃度。
流量预估 峰值流量取决于入口流量和玩法漏斗转化率，进而取决于：
宣传入口：如春晚口播、全局弹窗、feed 流强插、挂件等，其中最有效的是春晚口播和全局弹窗 用户数量：一般按高峰活跃用户数量估计，如有往年数据可以直接以 DAU 比例计算，如果定向圈人则需考虑圈人比例 是否打散：打散是削峰的关键，需要除以打散时长，一般推崇向前打散 玩法转化：如有往年数据可直接参考，如无则需依赖产品估算各级漏斗转化率给口径 流量预估会进行多次，一般是需求评审后 RD 会拍个粗估的峰值去做技术方案，开发期间 RD 和产品经过多轮讨论才能给出细化的预估，最终会通过演练场次算出精确的流量预估。此外对于红包雨这种玩法，在初期是无法确定真实的流量范围的，是否有春晚口播、是否使用全局弹窗，这些都不是前期能定下来的，所以初期技术方案设计上得按高估计。
不过如果产品往年做过类似玩法，可以参考往年数据进行粗估。
如有春晚口播，初期流量预估可以直接按该玩法普通导流方式的流量乘以十倍。
技术方案 技术挑战 大流量与高并发 应对挑战：
开始时会瞬间涌入大量用户 配置下发、玩法产生大量请求，对机房带宽产生压力 与秒杀不同，红包雨需要尽量保证用户能领取到奖励，大量请求能走完领奖的完整流程 解决方案：
入口打散 减少网络交互，接口简单 限流 提前建连保活 稳定性与容灾 应对挑战：
高并发下的玩法体验，保证服务稳定性 故障时的快速止损，恢复玩法体验 解决方案：
简化玩法，链路尽可能短，强依赖尽可能少 合理的重试、超时、限流配置 热备异构存储，设计合理的存储一致性维护方案 资金安全保障 应对挑战：
预算充足时正常发放，预算不足时发放兜底 每个用户的奖励需由策略算出，不能提前拆红包 保证各种情况下，不超发 解决方案：
合理设计预算控制模块抗超高流量的预算检查和扣除 梳理各种异常情况的兜底表现 幂等入账 对账、熔断、一致性校验 决策分歧点 附加需求 不展开
边缘机房 or 核心机房 机房分为核心机房和边缘机房，流量一般由边缘机房流向核心机房，边缘机房的特点是离用户更近，带宽承载能力更强，基础设施建设相对不完善。
选择流量终结在边缘机房的原因可能是：
极高稳定性和延迟要求 不希望超高流量打到核心机房影响核心业务 边缘机房到核心机房的带宽建设不足，可能无法承载超高流量 物理机 or 容器 在极端性能敏感或极致服务设计的情况下可以使用物理机，物理机的好处是：...</p></div><footer class=entry-footer>suimenno3002</footer><a class=entry-link aria-label="post link to " href=http://suimenno3002.github.io/posts/%E6%BC%AB%E8%B0%88%E7%BA%A2%E5%8C%85%E9%9B%A8%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Hello World</h2></header><div class=entry-content><p>你好，Blog。</p></div><footer class=entry-footer>suimenno3002</footer><a class=entry-link aria-label="post link to Hello World" href=http://suimenno3002.github.io/posts/hello-world/></a></article></main><footer class=footer><span>&copy; 2024 <a href=http://suimenno3002.github.io/>suimenno3002's blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>